!function(a,b,c,d){"use strict";function l(b,c){this.element=b,this.settings=a.extend({},f,c),this._defaults=f,this._name=e,this.init()}var e="musicPlayer",f={autoPlay:!1,volume:80,loop:!1,timeSeparator:" / ",playerAbovePlaylist:!0,infoElements:["title","artist"],elements:["artwork","information","controls","progress","time","volume"],timeElements:["current","duration"],controlElements:["backward","play","forward","stop"],onLoad:function(){},onPlay:function(){},onPause:function(){},onStop:function(){},onFwd:function(){},onRew:function(){},volumeChanged:function(){},progressChanged:function(){},trackClicked:function(){},onMute:function(){}},g="ontouchstart"in b,h=g?"touchstart":"mousedown",i=g?"touchmove":"mousemove",k=g?"touchcancel":"mouseup";a.extend(l.prototype,{init:function(){var b="",c="",d="",e="",f="",g="",h="",i="",j="",k="",l="",m="",n="",o="",p="",q="",r="",s="",t="",u="",v=this;for(var w in this.settings.elements)if("volume"==this.settings.elements[w])g="<div class='volume'><div class='volume-btn' title='Volume'></div><div class=' volume-adjust'><div><div></div></div></div></div>",f+=g;else if("progress"==this.settings.elements[w])h="<div class='progressbar'><div class='bar-loaded' ></div><div class='bar-played'></div></div>",f+=h;else if("artwork"==this.settings.elements[w])i="<div class='cover'></div>",f+=i;else if("information"==this.settings.elements[w]){l="-1"!=a.inArray("title",this.settings.infoElements)?"<div class='title'></div>":" ",m="-1"!=a.inArray("artist",this.settings.infoElements)?"<div class='artist'></div>":" ";for(var x in this.settings.infoElements)"title"==this.settings.infoElements[x]?e+=l:"artist"==this.settings.infoElements[x]&&(e+=m);d="<div class='info' >"+e+"</div>",f+=d}else if("time"==this.settings.elements[w]){r="-1"!=a.inArray("current",this.settings.timeElements)?"<div class='time-current'></div>":" ",s="-1"!=a.inArray("duration",this.settings.timeElements)?"<div class='time-duration'></div>":" ",t="<div class='time-separator'>"+this.settings.timeSeparator.replace(/\s/g,"&nbsp;")+"</div>";for(var x in this.settings.timeElements)1==x&&(c+=t),"current"==this.settings.timeElements[x]?c+=r:"duration"==this.settings.timeElements[x]&&(c+=s);j="<div class='timeHolder'>"+c+"</div>",f+=j}else if("controls"==this.settings.elements[w]){n="-1"!=a.inArray("backward",this.settings.controlElements)?"<div class='rew'></div>":" ",o="-1"!=a.inArray("forward",this.settings.controlElements)?"<div class='fwd'></div>":" ",p="-1"!=a.inArray("stop",this.settings.controlElements)?"<div class='stop'></div>":" ",q="-1"!=a.inArray("play",this.settings.controlElements)?"<div class='play'></div><div class='pause'></div>":" ";for(var x in this.settings.controlElements)"backward"==this.settings.controlElements[x]?b+=n:"play"==this.settings.controlElements[x]?b+=q:"forward"==this.settings.controlElements[x]?b+=o:"stop"==this.settings.controlElements[x]&&(b+=p);k="<div class='controls'>"+b+"</div>",f+=k}u=a("<div class='player' >"+f+"</div>"),this.settings.playerAbovePlaylist?a(u).insertBefore(a(this.element).find(".playlist")):a(u).insertAfter(a(this.element).find(".playlist")),this.playlistHolder=a(this.element).children(".playlist"),this.playerHolder=a(this.element).children(".player"),this.song="",this.theBar=this.playerHolder.find(".progressbar"),this.barPlayed=this.playerHolder.find(".bar-played"),this.barLoaded=this.playerHolder.find(".bar-loaded"),this.timeCurrent=this.playerHolder.find(".time-current"),this.timeDuration=this.playerHolder.find(".time-duration"),this.timeSeparator=this.settings.timeSeparator,this.volumeInfo=this.playerHolder.find(".volume"),this.volumeButton=this.playerHolder.find(".volume-btn"),this.volumeAdjuster=this.playerHolder.find(".volume-adjust > div"),this.volumeValue=this.settings.volume/100,this.volumeDefault=0,this.trackInfo=this.playerHolder.find(".info"),this.coverInfo=this.playerHolder.find(".cover"),this.controlsInfo=this.playerHolder.find(".controls"),this.controlPlay=a(this.controlsInfo).find(".play"),this.controlPause=a(this.controlsInfo).find(".pause"),this.controlStop=a(this.controlsInfo).find(".stop"),this.controlFwd=a(this.controlsInfo).find(".fwd"),this.controlRew=a(this.controlsInfo).find(".rew"),this.cssClass={playing:"playing",mute:"mute"},/iPad|iPhone|iPod/.test(navigator.userAgent)&&a(volumeInfo).hide(),this.initAudio(a(this.playlistHolder.children("li:first-child"))),this.song.volume=this.volumeValue,this.timeDuration.html("&hellip;"),this.timeCurrent.text(this.secondsToTime(0)),a(this.controlPlay).click(function(a){a.preventDefault(),v.playAudio()}),a(this.controlPause).click(function(a){a.preventDefault(),v.stopAudio(),v.settings.onPause()}),a(this.controlFwd).click(function(b){b.preventDefault(),v.stopAudio();var c=a(v.playlistHolder).find("li.active").next();0==c.length&&(c=a(v.playlistHolder).find("li:first-child")),v.loadNewSong(c),v.playAudio(),v.settings.onFwd()}),a(this.controlRew).click(function(b){b.preventDefault(),v.stopAudio();var c=a(v.playlistHolder).find("li.active").prev();0==c.length&&(c=a(v.playlistHolder).find("li:last-child")),v.loadNewSong(c),v.playAudio(),v.settings.onRew()}),a(this.controlStop).click(function(a){a.preventDefault(),v.stopAudio(),v.song.currentTime=0,v.settings.onStop()}),a(this.playlistHolder).find("li").click(function(b){b.preventDefault(),v.stopAudio(),v.loadNewSong(a(this)),v.playAudio(),v.settings.trackClicked()})},secondsToTime:function(a){var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.ceil(a%3600%60);return(0==b?"":b>0&&b.toString().length<2?"0"+b+":":b+":")+(c.toString().length<2?"0"+c:c)+":"+(d.toString().length<2?"0"+d:d)},adjustVolume:function(a){var b=g?a.originalEvent.touches[0]:a;this.song.volume=Math.abs((b.pageX-this.volumeAdjuster.offset().left)/this.volumeAdjuster.width())},adjustCurrentTime:function(a){var b=g?a.originalEvent.touches[0]:a;this.song.currentTime=Math.round(this.song.duration*(b.pageX-this.theBar.offset().left)/this.theBar.width())},initAudio:function(b){var c=b.children("a:first-child").attr("href"),d=b.text(),e=b.attr("data-cover"),f=b.attr("data-artist"),g=this;a(this.trackInfo).children(".title").text(d),a(this.trackInfo).children(".artist").text(f),a(this.coverInfo).css("background-image","url("+e+")"),this.song=new Audio(c),this.song.load(),this.song.addEventListener("loadeddata",function(){a(g.timeDuration).html(g.secondsToTime(this.duration)),a(g.volumeAdjuster).find("div").width(100*this.volume+"%"),g.volumeDefault=this.volume},!1),this.song.addEventListener("progress",function(){a(g.barLoaded).width(this.buffered.end(0)/this.duration*100+"%")}),this.song.addEventListener("timeupdate",function(){a(g.timeCurrent).text(g.secondsToTime(this.currentTime)),a(g.barPlayed).width(this.currentTime/this.duration*100+"%")}),this.song.addEventListener("volumechange",function(){Number(Math.round(100*this.volume+"e1")+"e-1")<=.4&&(this.volume=0),a(g.volumeAdjuster).find("div").width(100*this.volume+"%"),this.volume>0&&g.playerHolder.hasClass(g.cssClass.mute)&&g.playerHolder.removeClass(g.cssClass.mute),this.volume<=0&&!g.playerHolder.hasClass(g.cssClass.mute)&&g.playerHolder.addClass(g.cssClass.mute),g.volumeValue=this.volume}),this.song.addEventListener("ended",function(){g.settings.autoPlay?g.autoPlayNext():(g.playerHolder.removeClass(g.cssClass.playing),a(g.controlPlay).removeClass("hidden"),a(g.controlPause).removeClass("visible"))}),a(this.volumeButton).on("click",function(){return a(g.playerHolder).hasClass(g.cssClass.mute)?(a(g.playerHolder).removeClass(g.cssClass.mute),g.song.volume=g.volumeDefault):(a(g.playerHolder).addClass(g.cssClass.mute),g.volumeDefault=g.song.volume,g.song.volume=0,g.settings.onMute()),!1}),a(this.volumeAdjuster).on(h,function(a){g.adjustVolume(a),g.volumeAdjuster.on(i,function(a){g.adjustVolume(a)}),g.settings.volumeChanged()}).on(k,function(){g.volumeAdjuster.unbind(i)}),a(this.theBar).on(h,function(a){g.adjustCurrentTime(a),g.theBar.on(i,function(a){g.adjustCurrentTime(a)})}).on(k,function(){g.theBar.unbind(i),g.settings.progressChanged()}),a(this.playlistHolder).children("li").removeClass("active"),b.addClass("active"),this.settings.onLoad(),this.settings.autoPlay&&this.playAudio()},playAudio:function(){this.song.play(),this.playerHolder.addClass(this.cssClass.playing),"-1"!=a.inArray("controls",this.settings.elements)&&"-1"!=a.inArray("play",this.settings.controlElements)&&(a(this.controlPlay).addClass("hidden"),a(this.controlPause).addClass("visible")),this.settings.onPlay()},stopAudio:function(){this.song.pause(),this.playerHolder.removeClass(this.cssClass.playing),"-1"!=a.inArray("controls",this.settings.elements)&&"-1"!=a.inArray("play",this.settings.controlElements)&&(a(this.controlPlay).removeClass("hidden"),a(this.controlPause).removeClass("visible"))},autoPlayNext:function(){this.stopAudio();var b=a(this.playlistHolder).children("li.active").next();0==b.length&&this.settings.loop?(b=a(this.playlistHolder).children("li:first-child"),this.loadNewSong(b),this.playAudio()):0==!b.length&&(this.loadNewSong(b),this.playAudio())},loadNewSong:function(a){this.volumeValue=this.song.volume,this.initAudio(a),this.song.volume=this.volumeValue,this.volumeAdjuster.find("div").width(100*this.volumeValue+"%"),this.barPlayed.width(0),this.barLoaded.width(0)}}),a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new l(this,b))})}}(jQuery,window,document);